---
title: Workflow (Stages)
stage: Specification
status: New
priority: High
agenticHarness: opencode
modelProvider: opencode
modelName: claude-sonnet-4-5
---

# Description

Добавить поддержку стадий (stages) в воркфлоу задач. Стадии определяют текущий этап разработки задачи: Specification, Plan, Implementation, Verification.

## Requirements

### Стадии (stages)

- `Specification` - Создание спецификации
- `Plan` - Создание плана реализации
- `Implementation` - Реализация
- `Verification` - Верификация/тестирование

### Статусы (status)

- `New` - Новая задача на текущем этапе
- `In Progress` - Задача выполняется (запущена)
- `Done` - Задача на этапе завершена
- `Failed` - Задача на этапе завершилась с ошибкой

### Логика работы

1. Задача на этапе `Specification`, статус `New`
2. Запускаем задачу → статус `In Progress`
3. Завершилась успешно → статус `Done` на этом же этапе
4. Пользователь вручную переходит на этап `Plan` → меняем `stage: Plan`, статус автоматически `New`
5. Запускаем → снова статус `In Progress`

### Требования к реализации

1. **Frontmatter**
   - Добавить поле `stage` во фронтматтер
   - Дефолтное значение: `Specification`

2. **Backend**
   - Обновить `parseFrontmatter()` для извлечения `stage`
   - При обновлении задачи сохранять `stage`
   - API endpoint для изменения стадии задачи

3. **Frontend**
   - Добавить кнопку "Next Stage" в карточке задачи
   - Кнопка показывается только если статус `Done`
   - При нажатии:
     - Переходим на следующую стадию (последовательно)
     - Статус устанавливается в `New`
     - Если уже на последнем этапе (Verification) - кнопка не показывается
   - Отображать текущую стадию в карточке задачи

4. **UI**
   - В карточке задачи показывать стадию (например, бейдж "Plan")
   - Стадии окрашивать в разные цвета:
     - Specification: синий
     - Plan: фиолетовый
     - Implementation: оранжевый
     - Verification: зеленый

## Dependencies

- Зависит от: Задача 1 (System Settings), Задача 2 (Templates and Prompts)
- Блокирует: Задача 5 (Интеграция промптов)

## Acceptance Criteria

- ✅ Фронтматтер задачи содержит поле `stage`
- ✅ Кнопка "Next Stage" появляется только при статусе `Done`
- ✅ При нажатии кнопки стадия меняется последовательно
- ✅ Статус автоматически сбрасывается на `New` при смене стадии
- ✅ Стадия визуально отображается в карточке задачи
- ✅ На последней стадии (Verification) кнопка "Next Stage" не показывается
