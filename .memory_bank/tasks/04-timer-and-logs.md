---
title: Timer and Logs
stage: Specification
status: New
priority: High
agenticHarness: opencode
modelProvider: opencode
modelName: claude-sonnet-4-5
---

# Description

Добавить отображение таймера выполнения задачи и просмотр логов в реальном времени. Логи хранятся по отдельным файлам для каждого этапа.

## Requirements

### Логирование (по вариант 2)

Структура логов:
```
.memory_bank/logs/
  task-1-specification-1234567890.log
  task-1-plan-1234567891.log
  task-1-implementation-1234567892.log
```

Имя файла: `{taskId}-{stage}-{timestamp}.log`

### Таймер

**Где показывать:**
1. В карточке задачи (In Progress)
2. В модалке детального просмотра задачи
3. В модалке с логами в реальном времени

**Формат:**
- `HH:MM:SS` (часы:минуты:секунды)
- Обновление каждую секунду
- Остановка при получении результата (статус Done/Failed)

### Модалка детального просмотра

**Открывается при:**
- Клик по карточке задачи

**Содержимое:**
- Таймер (если запущена)
- Статус, этап, приоритет
- Выбранная модель
- Кнопка Stop (если запущена)
- Логи (полностью)
- Кнопки "Next Stage" (если Done)
- Кнопка "Close"

**Логи:**
- Показывать все существующие логи задачи
- Если задача запущена - показывать новые строки в реальном времени
- Логи сгруппированы по этапам

### Модалка с логами в реальном времени

**Открывается при:**
- Отдельная кнопка "View Logs" (если нужно) или автоматически

**Содержимое:**
- Таймер
- Логи в реальном времени
- Кнопки: Stop, Close

### Кнопка Stop

**Где показывать:**
- В карточке задачи (если In Progress)
- В модалке детального просмотра (если In Progress)

**Действие:**
- Останавливает процесс opencode
- Обновляет статус задачи на `Failed`
- Сохраняет логи
- Останавливает таймер

### Требования к реализации

1. **Backend**
   - Изменить формат имени файла логов на `{taskId}-{stage}-{timestamp}.log`
   - API endpoint для остановки задачи: `POST /api/tasks/:id/stop`
   - При остановке обновлять статус на `Failed` во фронтматтере

2. **Frontend**
   - Компонент `TaskTimer` для отображения таймера
   - Компонент `TaskDetailModal` для детального просмотра
   - Компонент `TaskLogsModal` для просмотра логов
   - Polling логов или WebSocket (выбор по сложности)
   - Таймер обновляется каждую секунду
   - При получении статуса `Done` или `Failed` - таймер останавливается

3. **UI**
   - Таймер в карточке: рядом с кнопкой "Stop"
   - Таймер в модалках: крупный шрифт сверху
   - Логи: моноширинный шрифт, цветовая подсветка

## Dependencies

- Зависит от: Задача 1 (System Settings), Задача 3 (Workflow)
- Блокирует: -

## Acceptance Criteria

- ✅ Таймер отображается в карточке задачи (In Progress)
- ✅ Таймер отображается в модалке детального просмотра
- ✅ Таймер отображается в модалке с логами
- ✅ Таймер останавливается при смене статуса на Done/Failed
- ✅ Логи хранятся по отдельным файлам для каждого этапа
- ✅ Имя файла: `{taskId}-{stage}-{timestamp}.log`
- ✅ Кнопка Stop останавливает задачу и обновляет статус
- ✅ При клике по карточке открывается модалка с деталями
- ✅ В модалке показываются все логи по этапам
- ✅ Новые логи появляются в реальном времени (если задача запущена)
