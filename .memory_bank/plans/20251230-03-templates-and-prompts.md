# План реализации: Templates and Stage Prompts

**Основан на спецификации:** `.memory_bank/tasks/02-templates-and-prompts.md`  
**Дата:** 2025-12-30  
**Версия:** 1.0  
**Статус:** Done

## Обзор

Создать шаблоны для задач, спецификаций и планов, а также промпты для каждого этапа воркфлоу.

## Предварительные требования

### Текущее состояние
- Структура `~/.ncrew/` создана в задаче 1
- Папки `templates/` и `stage_prompts/` существуют
- Нет файлов шаблонов и промптов

### Зависимости
- Задача 1 (System Settings) - Done
- `fs-extra` для работы с файлами

## Этап 1: Создание шаблонов

### 1.1. Шаблон задачи (task.md)

**Файл:** `~/.ncrew/templates/task.md`

**Содержимое:**
```yaml
---
title: Task Title
stage: Specification
status: New
priority: Medium
agenticHarness: opencode
modelProvider: opencode
modelName: claude-sonnet-4-5
---

# Description

Task description...

## Requirements

1. Requirement 1
2. Requirement 2

## Dependencies

- Зависит от: -
- Блокирует: -

## Acceptance Criteria

- ✅ AC 1
- ✅ AC 2
```

### 1.2. Шаблон спецификации (spec.md)

**Файл:** `~/.ncrew/templates/spec.md`

**Содержимое:**
```markdown
# Спецификация: <название>

**Имя:** <имя>  
**Дата:** <дата>  
**Версия:** <версия>  
**Статус:** <статус>

## Обзор

Краткое описание фичи.

## User Stories

### US-X.1: Название
Как **<роль>**, я хочу <действие>, чтобы <цель>.

## Требования

### Функциональные требования
...

### Нефункциональные требования
...

## Приемочные критерии

1. ✅ Критерий 1
2. ✅ Критерий 2
```

### 1.3. Шаблон плана (plan.md)

**Файл:** `~/.ncrew/templates/plan.md`

**Содержимое:**
```markdown
# План реализации: <название>

**Основан на спецификации:** <путь к спецификации>  
**Дата:** <дата>  
**Версия:** <версия>

## Обзор

План описывает реализацию фичи.

## Предварительные требования

...

## Этапы

### Этап 1: <название>
...

## Приемочные критерии

...
```

## Этап 2: Создание промптов этапов

### 2.1. Промпт для Specification

**Файл:** `~/.ncrew/stage_prompts/specification.md`

**Содержимое:**
```markdown
Прочитай и выполни задачу из файла {task_file}.

На выходе должна быть спецификация по шаблону ~/.ncrew/templates/spec.md.

Спецификация должна содержать:
- User Stories (минимум 2-3 истории)
- Функциональные требования
- Нефункциональные требования
- Приемочные критерии (минимум 5 критериев)

Результат сохрани в файл спецификации.
```

### 2.2. Промпт для Plan

**Файл:** `~/.ncrew/stage_prompts/plan.md`

**Содержимое:**
```markdown
Прочитай спецификацию из файла {task_file}.

Создай план реализации по шаблону ~/.ncrew/templates/plan.md.

План должен содержать:
- Предварительные требования
- Этапы (минимум 3 этапа)
- Детализированные задачи
- Приемочные критерии для каждого этапа

Результат сохрани в файл плана.
```

### 2.3. Промпт для Implementation

**Файл:** `~/.ncrew/stage_prompts/implementation.md`

**Содержимое:**
```markdown
Прочитай план реализации из файла {task_file}.

Реализуй функционал согласно плану.

Требования к реализации:
- Код должен следовать конвенциям проекта
- Использовать существующие библиотеки
- Писать тесты
- Обновлять документацию

После завершения запусти тесты и проверь их прохождение.
```

### 2.4. Промпт для Verification

**Файл:** `~/.ncrew/stage_prompts/verification.md`

**Содержимое:**
```markdown
Прочитай реализацию из файла {task_file}.

Проверь, что все приемочные критерии спецификации выполнены.

Проверки:
1. Функциональные тесты
2. Unit тесты
3. Integration тесты
4. Линтинг и типизация
5. Документация

Результат проверки: PASS/FAIL с объяснением.
```

## Этап 3: Обновление задачи

### 3.1. Обновить фронтматтер задачи

**Файл:** `.memory_bank/tasks/02-templates-and-prompts.md`

**Изменения:**
```yaml
---
title: Templates and Stage Prompts
stage: Implementation
status: In Progress
priority: High
agenticHarness: opencode
modelProvider: opencode
modelName: claude-sonnet-4-5
specification: ../specs/20251230-03-templates-and-prompts.md
plan: ../plans/20251230-03-templates-and-prompts.md
---
```

## Этап 4: Тестирование

### 4.1. Проверка создания файлов

**Сценарии:**
1. Проверить, что все шаблоны созданы в `~/.ncrew/templates/`
2. Проверить, что все промпты созданы в `~/.ncrew/stage_prompts/`
3. Проверить, что файлы содержат правильное содержимое

### 4.2. Проверка содержимого

**Проверить:**
- Шаблоны содержат правильную структуру YAML
- Промпты содержат ссылки на соответствующие шаблоны
- Промпты используют переменную `{task_file}`
- Промпты содержат инструкции для агента

### 4.3. Тест замены переменных

**Сценарий:**
- Создать тестовый скрипт для замены переменных
- Проверить, что `{task_file}` заменяется на путь к файлу

## Порядок выполнения

### Последовательные задачи:
1. Этап 1 (шаблоны)
2. Этап 2 (промпты)
3. Этап 3 (обновление задачи)
4. Этап 4 (тестирование)

## Приемочные критерии

После реализации проверить:
- ✅ Все файлы шаблонов созданы в `~/.ncrew/templates/`
- ✅ Все файлы промптов созданы в `~/.ncrew/stage_prompts/`
- ✅ Промпты содержат ссылки на соответствующие шаблоны
- ✅ Промпты используют переменную `{task_file}`

## Примечания

1. **Формат файлов:** MD файлы с YAML frontmatter для шаблонов
2. **Переменные:** Использовать плейсхолдеры `{task_file}` для замены
3. **Пути:** Использовать абсолютные пути к шаблонам в промптах (`~/.ncrew/templates/`)
4. **Структура:** Следовать указанным форматам строго для совместимости

## Зависимости

### Требуется проверить:
- Структура `~/.ncrew/templates/` и `~/.ncrew/stage_prompts/` существует

## Время реализации

Оценка:
- Этап 1 (шаблоны): 15 минут
- Этап 2 (промпты): 15 минут
- Этап 3 (обновление задачи): 5 минут
- Этап 4 (тестирование): 10 минут

**Итого:** 45 минут
