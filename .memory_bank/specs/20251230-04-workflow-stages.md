# Спецификация: Workflow (Stages)

**Имя:** Workflow (Stages)  
**Дата:** 2025-12-30  
**Версия:** 1.0  
**Статус:** Done

## Обзор

Добавить поддержку стадий (stages) в воркфлоу задач. Стадии определяют текущий этап разработки задачи: Specification, Plan, Implementation, Verification.

## User Stories

### US-3.1: Стадии воркфлоу
Как **Разработчик**, я хочу, чтобы каждая задача имела стадию (Specification, Plan, Implementation, Verification), чтобы понимать на каком этапе находится задача.

### US-3.2: Кнопка Next Stage
Как **Разработчик**, я хочу иметь кнопку "Next Stage" для перехода между этапами, чтобы вручную управлять прогрессом задачи.

### US-3.3: Визуализация стадий
Как **Разработчик**, я хочу видеть текущую стадию в карточке задачи с цветовой индикацией, чтобы быстро ориентироваться в статусе задач.

## Требования

### Функциональные требования

#### 1. Стадии (stages)

- `Specification` - Создание спецификации
- `Plan` - Создание плана реализации
- `Implementation` - Реализация
- `Verification` - Верификация/тестирование

#### 2. Статусы (status)

- `New` - Новая задача на текущем этапе
- `In Progress` - Задача выполняется (запущена)
- `Done` - Задача на этапе завершена
- `Failed` - Задача на этапе завершилась с ошибкой

#### 3. Логика работы

1. Задача на этапе `Specification`, статус `New`
2. Запускаем задачу → статус `In Progress`
3. Завершилась успешно → статус `Done` на этом же этапе
4. Пользователь вручную переходит на этап `Plan` → меняем `stage: Plan`, статус автоматически `New`
5. Запускаем → снова статус `In Progress`

#### 4. Frontmatter

- Добавить поле `stage` во фронтматтер
- Дефолтное значение: `Specification`

#### 5. Backend

- Обновить `parseFrontmatter()` для извлечения `stage`
- При обновлении задачи сохранять `stage`
- API endpoint для изменения стадии задачи

#### 6. Frontend

- Добавить кнопку "Next Stage" в карточке задачи
- Кнопка показывается только если статус `Done`
- При нажатии:
  - Переходим на следующую стадию (последовательно)
  - Статус устанавливается в `New`
  - Если уже на последнем этапе (Verification) - кнопка не показывается
- Отображать текущую стадию в карточке задачи

### Нефункциональные требования

1. **Визуализация:** Стадии окрашивать в разные цвета для быстрой идентификации
2. **Последовательность:** Переход между стадиями только последовательный
3. **Обратная совместимость:** Задачи без поля `stage` дефолтят к `Specification`

## Приемочные критерии

1. ✅ Фронтматтер задачи содержит поле `stage`
2. ✅ Кнопка "Next Stage" появляется только при статусе `Done`
3. ✅ При нажатии кнопки стадия меняется последовательно
4. ✅ Статус автоматически сбрасывается на `New` при смене стадии
5. ✅ Стадия визуально отображается в карточке задачи
6. ✅ На последней стадии (Verification) кнопка "Next Stage" не показывается
7. ✅ Цветовая индикация стадий работает корректно
