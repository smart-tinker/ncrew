# Спецификация: Task Management Integration

**Имя:** Task Management Integration  
**Дата:** 2025-12-30  
**Версия:** 1.0  
**Статус:** Done

## Обзор

Обновить команду запуска задачи для использования промптов этапа. При запуске подставлять пути к файлам задачи и шаблонов в промпты.

## User Stories

### US-5.1: Промпты этапов
Как **Разработчик**, я хочу, чтобы при запуске задачи использовался промпт соответствующего этапа, чтобы агент знал, что делать.

### US-5.2: Замена переменных
Как **Разработчик**, я хочу, чтобы переменные в промптах заменялись на реальные значения, чтобы промпты были универсальными.

## Требования

### Функциональные требования

1. **Чтение промпта этапа**
   - Прочитать промпт из `~/.ncrew/stage_prompts/{stage}.md`
   - Если промпт не найден - использовать дефолтный

2. **Замена переменных**
   - `{task_file}` → путь к файлу задачи
   - `{spec_template}` → путь к шаблону спецификации (если есть)
   - `{plan_template}` → путь к шаблону плана (если есть)

3. **Команда запуска**
   - Использовать промпт вместо фиксированной строки
   - Формат: `opencode -m <provider>/<name> run "<промпт>"`

4. **Логирование**
   - Добавить информацию о использованном промпте в логи

### Нефункциональные требования

1. **Обработка ошибок**
   - Если промпт не найден - использовать дефолтный промпт
   - Логирование ошибок чтения промпта

## Приемочные критерии

1. ✅ При запуске задачи используется промпт соответствующего этапа
2. ✅ Переменные в промпте заменяются на реальные значения
3. ✅ Команда opencode содержит корректный промпт
4. ✅ Если промпт не найден - используется дефолтный промпт
5. ✅ Логи содержат информацию о использованном промпте
