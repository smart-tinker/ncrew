# Спецификация: Timer and Logs

**Имя:** Timer and Logs  
**Дата:** 2025-12-30  
**Версия:** 1.0  
**Статус:** Done

## Обзор

Добавить отображение таймера выполнения задачи и просмотр логов в реальном времени. Логи хранятся по отдельным файлам для каждого этапа.

## User Stories

### US-4.1: Таймер выполнения
Как **Разработчик**, я хочу видеть таймер выполнения задачи, чтобы понимать, сколько времени уже заняло выполнение.

### US-4.2: Остановка задачи
Как **Разработчик**, я хочу иметь возможность остановить выполняющуюся задачу, чтобы прервать долгое выполнение.

### US-4.3: Детальный просмотр задачи
Как **Разработчик**, я хочу открывать детальный просмотр задачи по клику на карточку, чтобы видеть все детали и логи.

## Требования

### Функциональные требования

#### 1. Логирование

**Структура логов:**
```
.memory_bank/logs/
  task-1-specification-1234567890.log
  task-1-plan-1234567891.log
  task-1-implementation-1234567892.log
```

**Имя файла:** `{taskId}-{stage}-{timestamp}.log`

#### 2. Таймер

**Где показывать:**
1. В карточке задачи (In Progress)
2. В модалке детального просмотра задачи
3. (Опционально) В модалке с логами в реальном времени

**Формат:**
- `HH:MM:SS` (часы:минуты:секунды)
- Обновление каждую секунду
- Остановка при получении результата (статус Done/Failed)

#### 3. Модалка детального просмотра

**Открывается при:**
- Клик по карточке задачи

**Содержимое:**
- Таймер (если запущена)
- Статус, этап, приоритет
- Выбранная модель
- Кнопка Stop (если запущена)
- Логи (полностью)
- Кнопки "Next Stage" (если Done)
- Кнопка "Close"

**Логи:**
- Показывать все существующие логи задачи
- Если задача запущена - показывать новые строки в реальном времени
- Логи сгруппированы по этапам

#### 4. Кнопка Stop

**Где показывать:**
- В карточке задачи (если In Progress)
- В модалке детального просмотра (если In Progress)

**Действие:**
- Останавливает процесс opencode
- Обновляет статус задачи на `Failed`
- Сохраняет логи
- Останавливает таймер

#### 5. Backend изменения

- Изменить формат имени файла логов на `{taskId}-{stage}-{timestamp}.log`
- API endpoint для остановки задачи: `POST /api/tasks/:id/stop`
- При остановке обновлять статус на `Failed` во фронтматтере
- Добавить поле `startedAt` во фронтматтер

#### 6. Frontend изменения

- Компонент `TaskTimer` для отображения таймера
- Компонент `TaskDetailModal` для детального просмотра
- Компонент `TaskLogsModal` (опционально) для просмотра логов
- Таймер обновляется каждую секунду
- При получении статуса `Done` или `Failed` - таймер останавливается

### Нефункциональные требования

1. **Производительность:** Таймер не должен замедлять UI
2. **Отзывчивость:** Остановка задачи должна происходить быстро
3. **Совместимость:** Задачи без поля `startedAt` должны корректно обрабатываться

## Приемочные критерии

1. ✅ Таймер отображается в карточке задачи (In Progress)
2. ✅ Таймер отображается в модалке детального просмотра
3. ✅ Таймер останавливается при смене статуса на Done/Failed
4. ✅ Логи хранятся по отдельным файлам для каждого этапа
5. ✅ Имя файла: `{taskId}-{stage}-{timestamp}.log`
6. ✅ Кнопка Stop останавливает задачу и обновляет статус
7. ✅ При клике по карточке открывается модалка с деталями
8. ✅ В модалке показываются все детали задачи
9. ✅ В модалке показываются логи
10. ✅ API endpoint `/api/tasks/:id/stop` работает корректно
